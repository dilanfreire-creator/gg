
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Control</title>

    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white p-4">

    <h1 class="text-3xl font-bold mb-6 text-center text-cyan-300 drop-shadow-xl">
        Panel IoT
    </h1>

    <!-- INDICADOR DE ESTADO -->
    <div id="estadoFirebase" class="text-center p-4 mb-6 rounded-xl bg-red-800 border border-red-500 shadow-xl">
        <p class="text-xl font-bold">ðŸ”´ Desconectado</p>
        <p class="text-sm text-red-300">Esperando datos del servidor...</p>
    </div>

    <!-- SENSORES -->
    <div class="grid grid-cols-2 gap-4">

        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-xl">
            <h3 class="text-sm text-slate-400">Sensor 1</h3>
            <p id="temp1" class="text-3xl font-bold">-- Â°C</p>
        </div>

        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-xl">
            <h3 class="text-sm text-slate-400">Sensor 2</h3>
            <p id="temp2" class="text-3xl font-bold">-- Â°C</p>
        </div>

        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-xl">
            <h3 class="text-sm text-slate-400">Sensor 3</h3>
            <p id="temp3" class="text-3xl font-bold">-- Â°C</p>
        </div>

        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-xl">
            <h3 class="text-sm text-slate-400">Sensor 4</h3>
            <p id="temp4" class="text-3xl font-bold">-- Â°C</p>
        </div>
    </div>

    <!-- PROMEDIO -->
    <div class="mt-6 bg-slate-700 p-5 rounded-xl border border-slate-500 shadow-xl">
        <h3 class="text-sm text-slate-300">Promedio (4 sensores)</h3>
        <p id="promedio" class="text-4xl font-bold text-green-300 drop-shadow-lg">-- Â°C</p>
    </div>


<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD6p1_BVV6ZXjYxrbjGypYaiX0YrfPjNx4",
        authDomain: "renedilan-b4ac2.firebaseapp.com",
        databaseURL: "https://renedilan-b4ac2-default-rtdb.firebaseio.com",
        projectId: "renedilan-b4ac2",
        storageBucket: "renedilan-b4ac2.appspot.com",
        messagingSenderId: "1074659583496",
        appId: "1:1074659583496:web:8fc37c4b511cbf8e0bd3bd",
        measurementId: "G-X6Y1XGP0JM"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const sensoresRef = ref(db, "sensores");

    function estadoFirebase(conectado) {
        const box = document.getElementById("estadoFirebase");

        if (conectado) {
            box.className =
                "text-center p-4 mb-6 rounded-xl bg-green-800 border border-green-400 shadow-xl animate-pulse";

            box.innerHTML = `
                <p class="text-xl font-bold">ðŸŸ¢ Conectado</p>
                <p class="text-sm text-green-200">Datos recibidos correctamente</p>
            `;
        } else {
            box.className =
                "text-center p-4 mb-6 rounded-xl bg-red-800 border border-red-500 shadow-xl";

            box.innerHTML = `
                <p class="text-xl font-bold">ðŸ”´ Desconectado</p>
                <p class="text-sm text-red-300">Esperando conexiÃ³n...</p>
            `;
        }
    }

    // LECTURA EN TIEMPO REAL
    onValue(
        sensoresRef,
        (snap) => {
            const d = snap.val();

            if (!d) {
                estadoFirebase(false);
                return;
            }

            estadoFirebase(true);

            document.getElementById("temp1").textContent = d.temp1 + " Â°C";
            document.getElementById("temp2").textContent = d.temp2 + " Â°C";
            document.getElementById("temp3").textContent = d.temp3 + " Â°C";
            document.getElementById("temp4").textContent = d.temp4 + " Â°C";
            document.getElementById("promedio").textContent = d.promedio + " Â°C";
        },
        (error) => {
            console.error("Firebase error:", error);
            estadoFirebase(false);
        }
    );
</script>

</body>
</html>
